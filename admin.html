<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç† - å¯¼èˆªé…ç½®ç”Ÿæˆå™¨</title>
    <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ï¼Œä»¥ä¾¿è¯»å–ç°æœ‰é…ç½® -->
    <script src="config.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; padding: 20px; background: #f3f4f6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #3b82f6; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn { background: #3b82f6; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn:active { background: #2563eb; }
        .btn-copy { background: #10b981; margin-top: 20px; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 12px; background: #1f2937; color: #a5f3fc; margin-top: 20px; }
        .link-list { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .link-item { padding: 8px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ› ï¸ å¯è§†åŒ–é…ç½®ç”Ÿæˆå™¨</h2>
    <p style="color: #666; font-size: 0.9em;">å¡«å†™ä¸‹æ–¹è¡¨å•ï¼Œç”Ÿæˆä»£ç åå» GitHub æ›´æ–°ã€‚</p>

    <div class="form-group">
        <label>é€‰æ‹©åˆ†ç±» (æ·»åŠ åˆ°å“ªé‡Œ):</label>
        <select id="catSelect"></select>
    </div>

    <div class="form-group">
        <label>ç½‘ç«™åç§°:</label>
        <input type="text" id="inputTitle" placeholder="ä¾‹å¦‚: Bilibili">
    </div>

    <div class="form-group">
        <label>é“¾æ¥åœ°å€ (URL):</label>
        <input type="text" id="inputUrl" placeholder="https://www.bilibili.com">
    </div>

    <div class="form-group">
        <label>ç®€çŸ­æè¿°:</label>
        <input type="text" id="inputDesc" placeholder="äºŒæ¬¡å…ƒå¼¹å¹•ç½‘">
    </div>

    <div class="form-group">
        <label>å›¾æ ‡ (Emoji æˆ– å­—æ¯):</label>
        <input type="text" id="inputIcon" placeholder="B æˆ– ğŸ“º">
    </div>

    <button class="btn" onclick="generateCode()">âœ¨ ç”Ÿæˆæ–°é…ç½®ä»£ç </button>

    <!-- ç»“æœæ˜¾ç¤ºåŒº -->
    <textarea id="outputCode" readonly placeholder="ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œæ­¤å¤„å°†ç”Ÿæˆå®Œæ•´çš„ config.js ä»£ç ..."></textarea>
    
    <button class="btn btn-copy" onclick="copyCode()">ğŸ“‹ å¤åˆ¶ä¸Šæ–¹ä»£ç </button>

    <!-- ç°æœ‰é“¾æ¥å±•ç¤º -->
    <div class="link-list">
        <h3>ç°æœ‰é“¾æ¥é¢„è§ˆ</h3>
        <div id="currentLinks"></div>
    </div>
</div>

<script>
    // åˆå§‹åŒ–é¡µé¢
    window.onload = function() {
        if (!BackendData) {
            alert("é”™è¯¯ï¼šæ— æ³•è¯»å– config.jsï¼Œè¯·ç¡®ä¿ admin.html å’Œ config.js åœ¨åŒä¸€ç›®å½•ã€‚");
            return;
        }
        
        // 1. å¡«å……åˆ†ç±»ä¸‹æ‹‰æ¡†
        const catSelect = document.getElementById('catSelect');
        BackendData.categories.forEach((cat, index) => {
            const option = document.createElement('option');
            option.value = index; // ä½¿ç”¨ç´¢å¼•æ–¹ä¾¿æŸ¥æ‰¾
            option.text = cat.name;
            catSelect.appendChild(option);
        });

        // 2. å±•ç¤ºç°æœ‰é“¾æ¥
        renderLinks();
    };

    function renderLinks() {
        const container = document.getElementById('currentLinks');
        let html = '';
        BackendData.categories.forEach(cat => {
            html += `<strong>${cat.name}</strong>`;
            cat.links.forEach(link => {
                html += `<div class="link-item"><span>${link.icon} ${link.title}</span> <small>${link.url}</small></div>`;
            });
        });
        container.innerHTML = html;
    }

    function generateCode() {
        // è·å–è¾“å…¥å€¼
        const catIndex = document.getElementById('catSelect').value;
        const title = document.getElementById('inputTitle').value.trim();
        const url = document.getElementById('inputUrl').value.trim();
        const desc = document.getElementById('inputDesc').value.trim();
        const icon = document.getElementById('inputIcon').value.trim() || 'ğŸ”—';

        if (!title || !url) {
            alert("è¯·è‡³å°‘å¡«å†™ç½‘ç«™åç§°å’Œé“¾æ¥åœ°å€ï¼");
            return;
        }

        // åˆ›å»ºæ–°é“¾æ¥å¯¹è±¡
        const newLink = { title, url, desc, icon };

        // ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®å¯¹è±¡ (æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯ä¿®æ”¹äº† JS å†…å­˜å˜é‡ï¼Œè¿˜æ²¡ä¿å­˜åˆ°æ–‡ä»¶)
        BackendData.categories[catIndex].links.push(newLink);

        // å°†ä¿®æ”¹åçš„å¯¹è±¡è½¬æ¢å›ä»£ç å­—ç¬¦ä¸²
        // JSON.stringify(data, null, 4) ç”¨äºæ ¼å¼åŒ–ä»£ç 
        const codeString = `// ==========================================
// åç«¯æ•°æ®é…ç½®æ–‡ä»¶
// ä¿®æ”¹æ­¤å¤„å³å¯æ›´æ–°ç½‘ç«™å†…å®¹ï¼Œæ— éœ€è§¦ç¢° HTML
// ==========================================

const BackendData = ${JSON.stringify(BackendData, null, 4)};
`;

        // æ˜¾ç¤ºåœ¨æ–‡æœ¬æ¡†é‡Œ
        const output = document.getElementById('outputCode');
        output.value = codeString;
        
        // åˆ·æ–°é¢„è§ˆ
        renderLinks();
        
        alert("ä»£ç å·²ç”Ÿæˆï¼è¯·å¤åˆ¶ä¸‹æ–¹çš„ä»£ç ã€‚");
    }

    function copyCode() {
        const output = document.getElementById('outputCode');
        if (!output.value) {
            alert("è¯·å…ˆç”Ÿæˆä»£ç ï¼");
            return;
        }
        output.select();
        document.execCommand('copy'); // å…¼å®¹æ€§è¾ƒå¥½çš„å¤åˆ¶æ–¹æ³•
        alert("ä»£ç å·²å¤åˆ¶ï¼ç°åœ¨è¯·å» GitHub æ›¿æ¢ config.js çš„å†…å®¹ã€‚");
    }
</script>

</body>
</html>